<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Adicionar Produto - DIGIVEND</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #000; color: #fff; font-family: 'Poppins', sans-serif; }
    .card { background: #111; box-shadow: 0 0 12px #007bff55; border-radius: 12px; padding: 24px; max-width: 500px; margin: 40px auto; }
    .btn { background: #007bff; color: white; padding: 10px 18px; border-radius: 8px; cursor: pointer; width: 100%; }
    .btn:hover { background: #0056b3; }
    .progress { height: 8px; background: #333; border-radius: 4px; overflow: hidden; margin-bottom: 16px; }
    .bar { height: 8px; background: #007bff; width: 33%; transition: width 0.4s; }
    input, select, textarea { background: #222; border: none; color: #fff; border-radius: 6px; padding: 10px; width: 100%; margin-bottom: 16px; }
    label { color: #007bff; font-weight: 600; }
  </style>
</head>
<body>

  <div class="card">
    <h1 class="text-2xl font-bold text-center mb-4 text-blue-400">Adicionar Novo Produto</h1>
    <div class="progress"><div id="progressBar" class="bar"></div></div>

    <!-- Etapa 1 -->
    <form id="formEtapa1">
      <label>Foto do Produto</label>
      <input type="file" id="fotoProduto" accept="image/*" required>

      <label>Nome do Produto</label>
      <input type="text" id="nomeProduto" required>

      <label>Pre√ßo (m√≠nimo 99 MT)</label>
      <input type="number" id="precoProduto" min="99" required>

      <label>Desconto (%)</label>
      <input type="number" id="descontoProduto" min="0" max="90">

      <label>Cupom</label>
      <input type="text" id="cupomProduto" placeholder="Ex: CUPOMZ">

      <label>Descri√ß√£o</label>
      <textarea id="descricaoProduto" rows="4" minlength="150" required></textarea>
      <p class="text-sm text-gray-400" id="charCount">0/150 caracteres</p>

      <label>Categoria</label>
      <select id="categoriaProduto" required>
        <option value="">Selecione...</option>
        <option value="Empreender">Empreender</option>
        <option value="Neg√≥cios">Neg√≥cios</option>
        <option value="Sa√∫de">Sa√∫de</option>
        <option value="Educa√ß√£o">Educa√ß√£o</option>
        <option value="Outros">Outros</option>
      </select>

      <label>Tipo de Produto</label>
      <select id="tipoProduto" required>
        <option value="">Selecione...</option>
        <option value="Ebook">Ebook</option>
        <option value="Curso Online">Curso Online</option>
        <option value="Aplicativo">Aplicativo</option>
      </select>

      <div class="flex items-center mb-4">
        <input type="checkbox" id="permitirAfiliados" class="mr-2">
        <label for="permitirAfiliados">Permitir Afiliados</label>
      </div>

      <div id="afiliadoForm" style="display:none;">
        <label>Comiss√£o (%)</label>
        <input type="number" id="comissaoAfiliado" min="1" max="80">

        <label>Valor a Receber (MT)</label>
        <input type="text" id="valorAfiliado" readonly>

        <label>Link do Produto (Afiliado)</label>
        <input type="text" id="linkAfiliado" placeholder="https://...">
      </div>

      <button type="button" class="btn" id="btnEtapa1">Avan√ßar</button>
    </form>

    <!-- Etapa 2 -->
    <form id="formEtapa2" style="display:none;">
      <label>Envie o Arquivo ou Link</label>
      <div id="uploadArea"></div>
      <button type="button" class="btn" id="btnEtapa2">Avan√ßar</button>
    </form>

    <!-- Etapa 3 -->
    <div id="etapa3" style="display:none;">
      <p class="text-center text-blue-400 mb-4">üîç Verificando informa√ß√µes...</p>
      <div id="verificacao"></div>
      <button type="button" class="btn hidden" id="btnFinalizar">Finalizar</button>
    </div>
  </div>

  <script>
    const charCount = document.getElementById("charCount");
    const descricao = document.getElementById("descricaoProduto");
    descricao.addEventListener("input", () => {
      charCount.textContent = `${descricao.value.length}/150 caracteres`;
    });

    document.getElementById("permitirAfiliados").addEventListener("change", e => {
      document.getElementById("afiliadoForm").style.display = e.target.checked ? "block" : "none";
    });

    document.getElementById("comissaoAfiliado").addEventListener("input", () => {
      const preco = parseFloat(document.getElementById("precoProduto").value || 0);
      const comissao = parseFloat(document.getElementById("comissaoAfiliado").value || 0);
      document.getElementById("valorAfiliado").value = ((preco * comissao) / 100).toFixed(2);
    });

    document.getElementById("btnEtapa1").onclick = () => {
      document.getElementById("formEtapa1").style.display = "none";
      document.getElementById("formEtapa2").style.display = "block";
      document.getElementById("progressBar").style.width = "66%";
      const tipo = document.getElementById("tipoProduto").value;
      const uploadArea = document.getElementById("uploadArea");
      uploadArea.innerHTML = tipo === "Ebook" 
        ? '<input type="file" id="arquivoProduto" accept=".pdf" required>'
        : '<input type="text" id="linkProduto" placeholder="Cole o link do produto" required>';
    };

    document.getElementById("btnEtapa2").onclick = () => {
      document.getElementById("formEtapa2").style.display = "none";
      document.getElementById("etapa3").style.display = "block";
      document.getElementById("progressBar").style.width = "100%";
      verificar();
    };

    function verificar() {
      const verificacao = document.getElementById("verificacao");
      const etapas = ["Verificando nome...", "Analisando imagem...", "Confirmando arquivo..."];
      let i = 0;
      const intervalo = setInterval(() => {
        if (i < etapas.length) {
          verificacao.innerHTML += `<p>${etapas[i]}</p>`;
          i++;
        } else {
          clearInterval(intervalo);
          verificacao.innerHTML += `<p class='text-green-400'>‚úÖ Tudo pronto!</p>`;
          document.getElementById("btnFinalizar").classList.remove("hidden");
        }
      }, 1500);
    }

    document.getElementById("btnFinalizar").onclick = () => {
      const produto = {
        nome: document.getElementById("nomeProduto").value,
        preco: document.getElementById("precoProduto").value,
        categoria: document.getElementById("categoriaProduto").value,
        tipo: document.getElementById("tipoProduto").value,
        descricao: document.getElementById("descricaoProduto").value,
        status: "Pendente"
      };

      let produtos = JSON.parse(localStorage.getItem("produtos")) || [];
      produtos.push(produto);
      localStorage.setItem("produtos", JSON.stringify(produtos));

      alert("üì¶‚úÖ Produto criado com sucesso! Voc√™ ser√° redirecionado...");
      window.location.href = "meus_produtos.html";
    };
  </script>

</body>
</html>
